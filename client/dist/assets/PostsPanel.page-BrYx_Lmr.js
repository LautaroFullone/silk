import{u as U,d as K,j as e}from"./data-DYEAm0ln.js";import{A as b}from"./ActionButton-DzR36GRU.js";import{L as v,I as Q}from"./label-UeXQHYUk.js";import{c as W,t as F,n as P,B as j,r as C,F as R,S as J}from"./index-Btd106Xw.js";import{C as k,a as O,b as X,c as Y,d as Z}from"./card-BcU0pFzW.js";import{C as ee,S as I,a as M,b as D,c as B,d as x}from"./select-BdrtPeHB.js";import{r as T,e as q}from"./routing-DS5dkcPc.js";import{P as se,u as ae,a as le}from"./Pagination-BHX7naYZ.js";import{u as re}from"./useFetchPosts-BEJPsD40.js";import{P as te}from"./PageTitle-BWCi9lx9.js";import{S as A,D as ie,a as ne,E as oe,b as de,c as L,d as ce,C as me}from"./EmptyBanner-CbOw3NCx.js";import{e as xe}from"./extractErrorDetails-DKJ0Bd4I.js";import{q as _}from"./reactQueryKeys-DAqxpf92.js";import{d as he}from"./posts.service-DGdXb3Qp.js";import{f as ue}from"./formatDateToShow-BRBfFpow.js";import{g as fe}from"./getPublicImage-Cs9qxQh-.js";import{B as w}from"./badge-CqhZLHZT.js";import{S as i}from"./skeleton-6tEhAvAW.js";import{T as y}from"./trash-2-DV_Y-GfN.js";import{U as ge}from"./user-ZVh99WFc.js";import{C as je}from"./calendar-CfB7Un8h.js";import{P as z}from"./plus-KAhXE7BW.js";import"./vendor-CCYiWZgt.js";import"./index-D3Xd0-h6.js";import"./arrow-left-qWkhONps.js";const pe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ne=W("info",pe);function ve(){const s=U(),{mutateAsync:t,isPending:r}=K({mutationFn:he,onSuccess:({message:a})=>{F.success(a),s.invalidateQueries({queryKey:[_.FETCH_POSTS]})},onError:a=>{if(a?.message==="Network Error")return;const{message:l}=xe(a);F.error(l,{id:`error-${_.DELETE_POST}`})}});return{deletePostMutate:t,isPending:r}}const we=({title:s,description:t,mode:r="info",withDropdown:a,primaryAction:l,secondaryAction:n,classname:u})=>{const[f,d]=T.useState(!1),o=a?f:!0;return e.jsxs("div",{className:P(`p-4 border-l-4 rounded-r-md ${r==="info"?"text-emerald-800 bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-600":"text-red-800 bg-gradient-to-r from-rose-50 to-red-50 border-red-600"}`,u),children:[e.jsxs("div",{onClick:a?()=>d(c=>!c):void 0,className:P("flex items-center justify-between",a&&"cursor-pointer"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"size-5 flex-shrink-0"}),e.jsx("h4",{className:"font-medium ",children:s})]}),a&&e.jsx(ee,{className:`size-4 text-emerald-600 transition-transform duration-300 ${o&&"rotate-180"}`})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-600! ${o?"max-h-[500px]":"max-h-0"}`,children:e.jsxs("div",{className:"lg:flex lg:justify-between lg:items-start lg:gap-4",children:[e.jsx("div",{className:"lg:flex-1",children:Array.isArray(t)?e.jsx("ul",{className:"text-sm px-8 list-disc list-inside space-y-1 mt-2",children:t.map((c,g)=>e.jsx("li",{children:c},g))}):e.jsx("p",{className:"text-sm px-8 mt-2",children:t})}),(l||n)&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 mt-3 px-8 lg:px-0 lg:mt-0 lg:flex-shrink-0 lg:min-w-fit",children:[l&&e.jsx(b,{variant:r==="info"?"primary":"destructive",icon:l.icon,onClick:l.onClick,disabled:l.disabled,label:l.label,isLoading:l.isLoading}),n&&e.jsx(j,{variant:"outline",className:"text-primary",onClick:n.onClick,children:n.label})]})]})})]})},S=({post:s,onEdit:t,onDelete:r})=>{const[a,l]=T.useState(!1);return e.jsx(k,{className:P("overflow-hidden transition-all p-0 hover:shadow-md cursor-pointer"," md:h-45 flex flex-col md:flex-row",s.isActive?"border-l-6 border-l-emerald-700":"border-l-6 border-l-gray-600"),children:e.jsxs(O,{className:"p-0 flex flex-col md:flex-row h-full w-full cursor-default",children:[e.jsxs("div",{className:"relative w-full h-40 md:h-full md:w-48 flex-shrink-0 overflow-hidden",children:[e.jsx("img",{alt:s.title,className:"w-full h-full object-cover",src:fe(s.imageFilePath),onError:n=>{n.currentTarget.src="/image-placeholder.svg"}}),e.jsx("div",{className:"absolute top-2 left-2",children:s.isActive?e.jsx(w,{variant:"default",className:"bg-gradient-to-b from-emerald-600 to-emerald-800 text-white border-none",children:"Publicado"}):e.jsx(w,{variant:"default",className:"bg-gradient-to-b from-gray-500 to-gray-700 text-white border-none",children:"Borrador"})})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col h-40 md:h-full",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3 min-w-0",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-very-vogue text-xl md:text-2xl text-silk-secondary line-clamp-2 leading-tight",title:s.title,children:s.title})}),e.jsxs("div",{className:"flex-shrink-0 gap-2 hidden lg:flex",children:[e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>t(s),children:[e.jsx(A,{className:"size-4"}),"Editar"]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>r(s),className:"text-destructive!",children:[e.jsx(y,{className:"size-4"}),"Eliminar"]})]}),e.jsx("div",{className:"flex-shrink-0 flex lg:hidden",children:e.jsxs(ie,{open:a,onOpenChange:l,children:[e.jsx(ne,{asChild:!0,children:e.jsxs(j,{size:"icon",variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Abrir menú"})]})}),e.jsxs(de,{align:"end",children:[e.jsxs(L,{onClick:()=>{t(s),l(!1)},className:"text-silk-secondary font-normal",children:[e.jsx(A,{className:"mr-3 h-4 w-4 text-silk-secondary"}),"Editar"]}),e.jsxs(L,{onClick:()=>{r(s),l(!1)},className:"text-destructive! hover:bg-red-50!",children:[e.jsx(y,{className:"mr-3 h-4 w-4 text-destructive"}),"Eliminar"]})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap items-center text-xs md:text-sm gap-x-3 gap-y-1 text-muted-foreground mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsx("span",{className:"truncate",children:s.author})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsx("span",{children:ue(s.date,"date")})]}),e.jsx(w,{variant:"outline",className:"border-silk-primary-200 bg-silk-primary-100 text-silk-primary-800 rounded-sm text-xs",children:s.category.name})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 flex-1",children:s.description})]})]})})};S.Skeleton=function(){return e.jsx(k,{className:"overflow-hidden transition-all p-0 h-80 md:h-45 flex flex-col md:flex-row",children:e.jsxs("div",{className:"p-0 flex flex-col md:flex-row h-full w-full",children:[e.jsxs("div",{className:"relative w-full h-40 md:h-full md:w-48 flex-shrink-0 overflow-hidden",children:[e.jsx(i,{className:"w-full h-full"}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(i,{className:"h-6 w-20 rounded-full"})})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col h-40 md:h-full",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(i,{className:"h-5 md:h-6 w-full max-w-48"})}),e.jsxs("div",{className:"flex-shrink-0 gap-2 hidden lg:flex",children:[e.jsx(i,{className:"h-8 w-20"}),e.jsx(i,{className:"h-8 w-24"})]}),e.jsx("div",{className:"flex-shrink-0 flex lg:hidden",children:e.jsx(i,{className:"h-8 w-8 rounded"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center mb-2 gap-x-3 gap-y-1",children:[e.jsx(i,{className:"h-3 md:h-4 w-20"}),e.jsx(i,{className:"h-3 md:h-4 w-16"}),e.jsx(i,{className:"h-4 w-12 rounded-sm"})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(i,{className:"h-3 md:h-4 w-full"}),e.jsx(i,{className:"h-3 md:h-4 w-3/4"})]})]})]})})};const be=({paginatedPosts:s,isLoading:t,currentPage:r,totalPages:a,canGoNext:l,canGoPrevious:n,onPageChange:u,emptyMessage:f})=>{const[d,o]=T.useState(null),c=q(),{deletePostMutate:g,isPending:p}=ve();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:t?Array.from({length:5}).map((m,N)=>e.jsx(S.Skeleton,{},`skeleton-post-${N}`)):s.length?s.map(m=>e.jsx(S,{post:m,onEdit:()=>{c(C.ADMIN_POST_EDIT.replace(":postId",m.id))},onDelete:o},`post-card-${m.id}`)):e.jsx("div",{className:"col-span-full",children:e.jsx(ce,{title:"No hay posts registrados",description:f})})}),a>1&&!t&&e.jsx(se,{scrollToTop:!0,currentPage:r,totalPages:a,onPageChange:u,canGoNext:l,canGoPrevious:n}),e.jsx(me,{isOpen:!!d,isLoading:p,title:e.jsxs(e.Fragment,{children:['¿Estás seguro que querés eliminar el post "',e.jsx("span",{className:"font-bold",children:d?.title}),'"?']}),description:"Se eliminará permanentemente el post. Esta acción no se puede deshacer.",confirmButton:{icon:y,label:"Eliminar post",loadingLabel:"Eliminando...",variant:"destructive",onConfirm:async()=>{await g(d.id),o(null)}},cancelButton:{label:"No, mantener",variant:"outline",onCancel:()=>o(null)}})]})},We=()=>{const s=q(),{posts:t,isLoading:r}=re({onlyActive:!1}),{items:a,searchTerm:l,setSearchTerm:n,filters:u,updateFilter:f,clearFilters:d,hasActiveFilters:o}=ae({data:t,searchFields:["title","author","category"],initialFilters:{isActive:"all"}}),{currentPage:c,totalPages:g,startIndex:p,endIndex:m,itemsPerPage:N,goToPage:$,canGoNext:V,canGoPrevious:G,setItemsPerPage:H}=le({totalItems:a.length,itemsPerPage:10}),E=a.slice(p,m);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx(te,{title:"Gestión de Posts",description:"Crea y administra el contenido de los posts"}),e.jsx(b,{size:"lg",icon:z,variant:"primary",label:"Nuevo Post",className:"hidden md:flex",onClick:()=>s(C.ADMIN_POST_NEW)})]}),e.jsx(we,{title:"Información importante",withDropdown:!0,description:["Las categorías se generan automáticamente a partir de los posts. Si se crea un post nuevo con una categoría distinta, ésta se añadirá. Si se elimina el único post de una categoría, esa categoría también será eliminada."]}),e.jsx(b,{size:"lg",icon:z,variant:"primary",label:"Nuevo Post",onClick:()=>s(C.ADMIN_POST_NEW),className:"md:hidden w-full"}),e.jsxs(k,{children:[e.jsxs(X,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"size-5 text-emerald-800"}),"Listado de Posts"]}),e.jsx(Z,{children:"Filtrá por Título, Autor y/o Categoría"})]}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(v,{htmlFor:"search-filter",children:"Buscar por Título, Autor o Categoría"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(J,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{id:"search-filter",value:l,disabled:r,className:"pl-8 bg-white",placeholder:"Ej: Tendencias de Moda",onChange:h=>n(h.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"highlight-filter",children:"Estado"}),e.jsxs(I,{value:u.isActive||"all",onValueChange:h=>f("isActive",h),disabled:r,children:[e.jsx(M,{className:"mt-1 w-full",id:"highlight-filter",children:e.jsx(D,{placeholder:"Todos"})}),e.jsxs(B,{children:[e.jsx(x,{value:"all",children:"Todos"}),e.jsx(x,{value:"true",children:"Publicado"}),e.jsx(x,{value:"false",children:"Borrador"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between col-span-full gap-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:E.length===0?"Mostrando 0 de 0 posts":`Mostrando ${p+1}-${Math.min(m,a.length)} de ${a.length} posts`}),e.jsxs("div",{className:"flex items-center gap-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{htmlFor:"items-per-page",className:"text-sm whitespace-nowrap",children:"Mostrar:"}),e.jsxs(I,{value:N.toString(),disabled:r,onValueChange:h=>H(h==="*"?"*":Number(h)),children:[e.jsx(M,{id:"items-per-page",children:e.jsx(D,{})}),e.jsxs(B,{children:[e.jsx(x,{value:"5",children:"5"}),e.jsx(x,{value:"10",children:"10"}),e.jsx(x,{value:"25",children:"25"}),e.jsx(x,{value:"*",children:"Todos"})]})]})]}),e.jsx(j,{variant:"default",onClick:d,disabled:r||!o,children:"Limpiar Filtros"})]})]})]}),e.jsx(be,{paginatedPosts:E,isLoading:r,currentPage:c,totalPages:g,canGoNext:V,canGoPrevious:G,onPageChange:$,emptyMessage:o?"No hay posts que coincidan con los filtros, probá limpiarlos o intentá con otros términos de búsqueda":'Hacé clic en "Nuevo Post" para crear el primero'})]})]})]})};export{We as default};
