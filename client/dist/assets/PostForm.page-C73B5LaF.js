import{u as se,d as ae,j as e}from"./data-DYEAm0ln.js";import{O as ce,u as de,I as O}from"./InputForm-CbdPvAYo.js";import{r as M,h as me}from"./routing-DS5dkcPc.js";import{c as ue,t as C,v as ge,w as pe,B as H,n as v,x as he,y as xe,z as fe,A as je,D as G,E as V}from"./index-Btd106Xw.js";import{e as te}from"./extractErrorDetails-DKJ0Bd4I.js";import{c as be,u as ye}from"./posts.service-DGdXb3Qp.js";import{q as P}from"./reactQueryKeys-DAqxpf92.js";import{u as Ne}from"./useFetchPosts-BEJPsD40.js";import{T as Ce,u as ve,F as Pe,o as we}from"./style-ImJSc9pL.js";import{L as Ee,A as Z}from"./ActionButton-DzR36GRU.js";import{S as X,U as Fe,T as Se,C as Te}from"./TextAreaForm-a6SSDwrs.js";import{L as _,I as Ae}from"./label-UeXQHYUk.js";import{S as U}from"./skeleton-6tEhAvAW.js";import{C as Y}from"./index-D3Xd0-h6.js";import{P as Le}from"./plus-KAhXE7BW.js";import{C as De,b as ke,c as ze,d as Ie,a as Be}from"./card-BcU0pFzW.js";import{P as qe}from"./PageTitle-BWCi9lx9.js";import{T as Oe}from"./trash-2-DV_Y-GfN.js";import"./vendor-CCYiWZgt.js";import"./arrow-left-qWkhONps.js";const Ge=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Ve=ue("chevrons-up-down",Ge),Me=()=>{const l=se(),{mutateAsync:i,isPending:n}=ae({mutationFn:be,onSuccess:({message:s})=>{C.success(s),l.invalidateQueries({queryKey:[P.FETCH_POSTS]})},onError:s=>{if(s?.message==="Network Error")return;const{message:t}=te(s);C.error(t,{id:`error-${P.CREATE_POST}`})}});return{createPostMutate:i,isPending:n}},He=()=>{const l=se(),{mutateAsync:i,isPending:n}=ae({mutationFn:ye,onSuccess:({message:s,post:t})=>{s==="No hay cambios para aplicar"?C.info(s):(C.success(s),l.invalidateQueries({queryKey:[P.FETCH_POSTS]}),l.setQueryData([P.FETCH_POST,t.id],()=>({post:t})))},onError:s=>{if(s?.message==="Network Error")return;const{message:t}=te(s);C.error(t,{id:`error-${P.UPDATE_POST}`})}});return{updatePostMutate:i,isPending:n}};function h(l){return l?(l??"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g," "):""}const _e=({id:l,name:i,label:n,value:s,placeholder:t="Seleccionar...",searchPlaceholder:A="Buscar...",optionsHeader:L="Opciones disponibles",options:x,onSelect:w,onCreate:f,hasError:D=!1,errorMessages:j=[],isLoadingInput:r=!1,isLoadingOptions:d=!1,buttonClassName:b,newItemPrefix:E="Nueva:",noResultsMessage:u="No se encontraron resultados.",loadingMessage:k="Cargando opciones...",disabled:y=!1,isFilterMode:g=!1,showAllOption:F=!1,allOptionLabel:o="Todas",register:c,errors:m})=>{const[z,S]=M.useState(!1),[p,T]=M.useState(""),I=i&&m?i.split(".").reduce((a,N)=>a?.[N],m):null,$=!!I,Q=$||D,R=$&&I?.message?[I.message]:j,B=Array.isArray(x)?x:Object.entries(x).map(([a,N])=>({id:a,label:N})),K=s?B.find(a=>g?a.id===s:h(a.label)===h(s)):void 0,re=!!(s&&!K&&!g),q=B.filter(a=>h(a.label).includes(h(p))),oe=B.some(a=>h(a.label)===h(p)),J=!!p.trim()&&!oe&&f,ie=!d&&q.length===0&&!J,ne=a=>{w(g?a.id:a.label),T(""),S(!1)},le=()=>{f&&(f(p),T(""),S(!1))},W=s==="all";return e.jsxs("div",{className:"space-y-1",children:[n&&e.jsx(_,{htmlFor:l,className:"mb-1",children:n}),r?e.jsx(U,{className:"w-full h-9"}):e.jsxs(e.Fragment,{children:[e.jsxs(ge,{open:z,onOpenChange:S,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(H,{id:l,variant:"outline",role:"combobox","aria-expanded":z,disabled:y,className:v("relative w-full hover:bg-white font-normal border-input","focus:border-ring focus:ring-ring/50 focus:ring-[3px]",Q&&"border-red-500 focus:border-0 focus-visible:ring-red-500",b),children:[e.jsx("span",{className:"truncate block text-left w-[calc(100%-24px)] -ml-5",children:s?W?o:re&&!g?`${E} ${s}`:K?.label||s:t}),e.jsx(Ve,{className:"size-4 absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"})]})}),e.jsx(he,{className:"w-full p-0",children:e.jsxs(xe,{children:[e.jsx(fe,{placeholder:A,disabled:d,value:p,onValueChange:T}),e.jsxs(je,{children:[d&&e.jsxs("div",{className:"flex items-center justify-center py-6",children:[e.jsx(Ee,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:k})]}),!d&&F&&e.jsx(G,{children:e.jsxs(V,{value:o,onSelect:()=>{w("all"),T(""),S(!1)},children:[e.jsx(Y,{className:v("text-emerald-800 size-4",W?"opacity-100":"opacity-0")}),o]})}),J&&e.jsx(G,{children:e.jsxs(V,{value:p,onSelect:le,children:[e.jsx(Le,{className:"size-4"}),'Crear "',p,'"']})}),!d&&q.length>0&&e.jsx(G,{heading:L,children:q.map(a=>e.jsxs(V,{value:a.label,onSelect:()=>ne(a),children:[e.jsx(Y,{className:v("text-emerald-800 size-4",(g?s===a.id:s===a.label)?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate block max-w-3xs md:max-w-md",children:a.label})]},a.id))}),ie&&e.jsx("div",{className:"py-6 text-sm text-muted-foreground text-center",children:u})]})]})})]}),c&&i&&e.jsx("input",{type:"hidden",value:s||"",...c}),Q&&R?.length>0&&e.jsx("p",{className:"mt-1 text-xs text-red-500 flex flex-col gap-1",children:R.map((a,N)=>e.jsxs("span",{className:"flex flex-row gap-1",children:[e.jsx(ce,{size:13,className:"shrink-0"}),a]},`error-${N}`))})]})]})},ee={title:"",author:"",date:new Date().toISOString().split("T")[0],description:"",content:[],categoryName:"",isActive:!1,imageFile:void 0},ds=()=>{const{postId:l}=me(),i=!!l,n=Ce({dictionary:we}),{post:s,isLoading:t}=ve({postId:l}),{categories:A,isLoading:L}=Ne({onlyActive:!1}),{createPostMutate:x,isPending:w}=Me(),{updatePostMutate:f,isPending:D}=He(),{watch:j,setValue:r,register:d,reset:b,handleSubmit:E,formState:{errors:u,isDirty:k}}=de({mode:"onSubmit",reValidateMode:"onChange",defaultValues:ee}),y=j("imageFile");M.useEffect(()=>(i&&s&&(r("title",s.title),r("author",s.author),r("date",s.date),r("description",s.description),r("categoryName",s.category.name),r("isActive",s.isActive),typeof s.content=="string"?r("content",[]):Array.isArray(s.content)&&s.content.length>0&&(r("content",s.content),n.replaceBlocks(n.document,s.content))),()=>{b(ee)}),[s,i,r,b,n]);const g=async c=>{const m={...c,content:n.document};i&&l&&s?await f({postId:l,postData:m}):(await x(m),b(),n.replaceBlocks(n.document,[]))},F=i?k:!Object.keys(u).length,o=w||D;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx(qe,{hasGoBack:!0,title:i?"Editar Post":"Crear Nuevo Post",description:i?"Actualiza la información del post":"Ingresá el contenido del post"}),e.jsx(Z,{size:"lg",icon:X,variant:"primary",label:i?"Guardar Cambios":"Guardar Post",className:"hidden md:flex",isLoading:o,disabled:!F||t,onClick:E(g)})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(De,{children:[e.jsxs(ke,{children:[e.jsx(ze,{children:"Información General"}),e.jsx(Ie,{children:"Detalle completo del post"})]}),e.jsxs(Be,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(O,{type:"text",name:"title",label:"Título",placeholder:"Ej: Tendencias en colores",isLoading:t,disabled:o,register:d("title",{required:"El título es obligatorio",maxLength:{value:100,message:"El título no puede superar los 100 caracteres"}}),errors:u}),e.jsx(O,{type:"text",name:"author",label:"Autor",placeholder:"Ej: Germán Beder",isLoading:t,disabled:o,register:d("author",{required:"El autor es obligatorio",maxLength:{value:50,message:"El autor no puede superar los 50 caracteres"},pattern:{value:/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/,message:"El autor solo puede contener letras y espacios"}}),errors:u})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(O,{type:"date",name:"date",label:"Fecha",isLoading:t,disabled:o,register:d("date",{required:"La fecha es obligatoria"}),errors:u}),e.jsx(_e,{id:"category",name:"categoryName",label:"Categoría",value:j("categoryName")||"",options:A,optionsHeader:"Categorías existentes",placeholder:"Seleccionar categoría...",searchPlaceholder:"Buscar o crear categoría...",onSelect:c=>r("categoryName",c,{shouldValidate:!0,shouldDirty:!0}),onCreate:c=>r("categoryName",c,{shouldValidate:!0,shouldDirty:!0}),register:d("categoryName",{required:"La categoría es requerida",maxLength:{value:50,message:"La categoría no puede superar los 50 caracteres"}}),errors:u,isLoadingInput:t,isLoadingOptions:L,loadingMessage:"Cargando categorías...",noResultsMessage:"No se encontraron categorías.",disabled:o})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"imageFile",children:"Imagen Portada"}),t?e.jsx(U,{className:"w-full h-9"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex",children:[e.jsx(Ae,{readOnly:!0,id:"imageFile",disabled:o,value:y?y.name:"",placeholder:"Seleccioná una imagen...",className:"rounded-r-none border-r-0 "}),e.jsxs("div",{className:"relative cursor-pointer",children:[e.jsx("input",{type:"file",id:"imageFile",accept:"image/*",disabled:o,onChange:c=>{const m=c.target.files?.[0];m&&(!["image/jpeg","image/jpg","image/png","image/webp"].includes(m.type)||m.size>3*1024*1024)||r("imageFile",m||void 0,{shouldDirty:!0,shouldValidate:!0})},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsx(H,{asChild:!0,type:"button",variant:"outline",disabled:o,className:"rounded-l-none border-l-0 px-3 h-full cursor-pointer shadow-none",children:e.jsx("label",{htmlFor:"imageFile",className:"flex items-center cursor-pointer",children:e.jsx(Fe,{className:"w-4 h-4 cursor-pointer"})})})]}),y&&e.jsx("div",{className:"flex items-center",children:e.jsxs(H,{size:"sm",variant:"ghost",className:"text-destructive! ml-4",onClick:()=>r("imageFile",void 0,{shouldDirty:!0,shouldValidate:!0}),children:[e.jsx(Oe,{className:"size-4"}),"Quitar imagen"]})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Formatos: JPG, JPEG, PNG o WEBP (máx. 3MB)"})]})]}),e.jsx(Se,{name:"description",label:"Descripción",isLoading:t,disabled:o,placeholder:"Ej: Descubrí los colores que potencian tu presencia.",register:d("description",{required:"La descripción es obligatoria",maxLength:{value:300,message:"La descripción no puede superar los 300 caracteres"}}),errors:u}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsx(Te,{name:"isActive",label:"Mostrar en la web",description:"Habilita que el post aparezca en la landing.",value:j("isActive")||!1,isLoading:t,disabled:o,onChange:c=>r("isActive",c,{shouldValidate:!0,shouldDirty:!0}),errors:u})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{htmlFor:"content",children:"Contenido"}),t?e.jsx(U,{className:"w-full h-32"}):e.jsx("div",{className:v("border border-gray-200 shadow-xs rounded-md","focus-within:border-ring focus-within:ring-ring/50 focus-within:ring-[3px]","transition-all duration-200",o&&"opacity-50 pointer-events-none cursor-not-allowed"),children:e.jsx(Pe,{"data-headings-font":!0,theme:"light",editor:n,formattingToolbar:!0,editable:!o,className:v("px-2 pt-2 ",n.document.length===1?"pb-8 sm:pb-2":"pb-2",""),onChange:()=>{r("content",n.document,{shouldDirty:!0,shouldValidate:!0})}})})]})]})]})}),e.jsx(Z,{size:"lg",icon:X,variant:"primary",label:i?"Guardar Cambios":"Guardar Post",className:"md:hidden",isLoading:o,disabled:!F||t,onClick:E(g)})]})]})};export{ds as default};
