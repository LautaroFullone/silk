import{u as q,d as D,e as O,j as e}from"./data-DYEAm0ln.js";import{A as I}from"./ActionButton-DzR36GRU.js";import{S as C,U as B,T as G,C as w}from"./TextAreaForm-a6SSDwrs.js";import{e as _,r as j,h as z}from"./routing-DS5dkcPc.js";import{t as p,r as Q,B as F}from"./index-Btd106Xw.js";import{C as L,b as S,c as A,d as V,a as P}from"./card-BcU0pFzW.js";import{L as $,I as K}from"./label-UeXQHYUk.js";import{S as J}from"./skeleton-6tEhAvAW.js";import{c as W,a as Z,u as X,Q as Y}from"./testimonials.service-2g7QNfhy.js";import{e as N}from"./extractErrorDetails-DKJ0Bd4I.js";import{q as u}from"./reactQueryKeys-DAqxpf92.js";import{u as ee,I as M}from"./InputForm-CbdPvAYo.js";import{P as se}from"./PageTitle-BWCi9lx9.js";import{g as ae}from"./getPublicImage-Cs9qxQh-.js";import{T as ie}from"./trash-2-DV_Y-GfN.js";import{S as te}from"./star-0ORt5L8P.js";import{U as re}from"./user-ZVh99WFc.js";import"./index-D3Xd0-h6.js";import"./vendor-CCYiWZgt.js";import"./arrow-left-qWkhONps.js";const oe=()=>{const r=q(),{mutateAsync:o,isPending:l}=D({mutationFn:W,onSuccess:({message:s})=>{p.success(s),r.invalidateQueries({queryKey:[u.FETCH_TESTIMONIALS]})},onError:s=>{if(s?.message==="Network Error")return;const{message:a}=N(s);p.error(a,{id:`error-${u.CREATE_TESTIMONIAL}`})}});return{createTestimonialMutate:o,isPending:l}},le=r=>{const{data:o,isLoading:l,error:s,isError:a}=O({queryKey:[u.FETCH_TESTIMONIAL,r.testimonialId],queryFn:()=>Z(r.testimonialId),staleTime:12e4,retry:1,enabled:!!r.testimonialId});if(a&&s.message!=="Network Error"){const{message:d}=N(s);p.error(d,{id:`error-${u.FETCH_TESTIMONIAL}-${r.testimonialId}`})}return{testimonial:o?.testimonial,isLoading:l,isError:a,error:s}},ne=()=>{const r=_(),o=q(),{mutateAsync:l,isPending:s}=D({mutationFn:X,onSuccess:({message:a,testimonial:d})=>{a==="No hay cambios para aplicar"?p.info(a):(p.success(a),o.invalidateQueries({queryKey:[u.FETCH_TESTIMONIALS]}),o.setQueryData([u.FETCH_TESTIMONIAL,d.id],{message:a,testimonial:d}),r(Q.ADMIN_TESTIMONIAL_LIST))},onError:a=>{if(a?.message==="Network Error")return;const{message:d}=N(a);p.error(d,{id:`error-${u.UPDATE_TESTIMONIAL}`})}});return{updateTestimonialMutate:l,isPending:s}},k={personName:"",personRole:"",description:"",isHighlight:!1,isActive:!0,avatarFile:void 0},Se=()=>{const[r,o]=j.useState(""),{testimonialId:l}=z(),s=!!l,{createTestimonialMutate:a,isPending:d}=oe(),{updateTestimonialMutate:H,isPending:U}=ne(),{testimonial:i,isLoading:c}=le({testimonialId:s?l:void 0}),{watch:m,setValue:n,register:v,reset:b,handleSubmit:T,formState:{errors:g,isDirty:R}}=ee({mode:"onSubmit",reValidateMode:"onChange",defaultValues:k}),h=m("avatarFile");j.useEffect(()=>{if(h instanceof File){const t=URL.createObjectURL(h);return o(t),()=>URL.revokeObjectURL(t)}s&&i?.avatarImagePath?o(ae(i.avatarImagePath)):o("")},[h,s,i]),j.useEffect(()=>(s&&i&&(n("personName",i.personName),n("personRole",i.personRole),n("description",i.description),n("isHighlight",i.isHighlight),n("isActive",i.isActive)),()=>{b(k)}),[i,s]);const y=async t=>{s&&l&&i?await H({testimonialId:l,testimonialData:t}):(await a(t),b())},E=s?R:!Object.keys(g).length,x=d||U;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx(se,{hasGoBack:!0,title:s?"Editar Testimonio":"Crear Nuevo Testimonio",description:s?"Actualiza la información del testimonio":"Ingresá el contenido del testimonio"}),e.jsx(I,{size:"lg",icon:C,variant:"primary",label:s?"Guardar Cambios":"Guardar Testimonio",className:"hidden md:flex",isLoading:x,disabled:!E||c,onClick:T(y)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(L,{children:[e.jsxs(S,{children:[e.jsx(A,{children:"Información General"}),e.jsx(V,{children:"Detalles básicos del testimonio"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(M,{type:"text",name:"personName",label:"Nombre",placeholder:"Ej: Germán Beder",isLoading:c,register:v("personName",{required:"El nombre es obligatorio",maxLength:{value:50,message:"El nombre no puede superar los 50 caracteres"},pattern:{value:/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/,message:"El nombre solo puede contener letras y espacios"}}),errors:g}),e.jsx(M,{type:"text",name:"personRole",label:"Profesión o Rol",placeholder:"Ej: Director de Marketing",isLoading:c,register:v("personRole",{required:"La profesión o rol es obligatoro",maxLength:{value:50,message:"La profesión no puede superar los 50 caracteres"}}),errors:g})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{htmlFor:"avatarFile",children:"Imagen del Cliente"}),c?e.jsx(J,{className:"w-full h-9"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex",children:[e.jsx(K,{readOnly:!0,id:"avatarFile",disabled:x,value:h?h.name:"",placeholder:"Seleccioná una imagen...",className:"rounded-r-none border-r-0 "}),e.jsxs("div",{className:"relative cursor-pointer",children:[e.jsx("input",{type:"file",id:"imageFile",accept:"image/*",disabled:x,onChange:t=>{const f=t.target.files?.[0];f&&(!["image/jpeg","image/jpg","image/png","image/webp"].includes(f.type)||f.size>3*1024*1024)||n("avatarFile",f||void 0,{shouldDirty:!0,shouldValidate:!0})},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsx(F,{asChild:!0,type:"button",variant:"outline",disabled:x,className:"rounded-l-none border-l-0 px-3 h-full cursor-pointer shadow-none",children:e.jsx("label",{htmlFor:"imageFile",className:"flex items-center cursor-pointer",children:e.jsx(B,{className:"w-4 h-4 cursor-pointer"})})})]}),h&&e.jsx("div",{className:"flex items-center",children:e.jsxs(F,{size:"sm",variant:"ghost",className:"text-destructive! ml-4",onClick:()=>n("avatarFile",void 0,{shouldDirty:!0,shouldValidate:!0}),children:[e.jsx(ie,{className:"size-4"}),"Quitar imagen"]})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Formatos: JPG, PNG o WEBP (máx. 3MB)"})]})]}),e.jsx(G,{label:"Descripción",name:"description",placeholder:"Ej: Silk transformó mi vida...",isLoading:c,register:v("description",{required:"El testimonio es obligatorio",maxLength:{value:500,message:"El testimonio no puede superar los 500 caracteres"}}),errors:g}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{label:"Mostrar en la web",name:"isActive",description:"Habilita que el testimonio aparezca en la landing.",value:m("isActive")||!1,isLoading:c,onChange:t=>n("isActive",t,{shouldValidate:!0,shouldDirty:!0}),errors:g}),e.jsx(w,{name:"isHighlight",label:"Testimonio destacado",description:"Permite que el testimonio tenga un distintivo.",value:m("isHighlight")||!1,isLoading:c,onChange:t=>n("isHighlight",t,{shouldValidate:!0,shouldDirty:!0}),errors:g})]})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs(L,{className:"overflow-hidden",children:[e.jsx(S,{children:e.jsx(A,{children:"Vista Previa"})}),e.jsxs(P,{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-4 w-full",children:[e.jsxs("div",{className:"relative flex-shrink-0 ",children:[e.jsx("div",{className:"w-16 h-16  rounded-full overflow-hidden border-3 border-white shadow-lg",children:e.jsx("img",{src:r||"/image-placeholder.svg",alt:"Person image",className:"w-16 h-16 object-cover"})}),m("isHighlight")===!0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-gradient-to-bl from-emerald-600 to-emerald-700 rounded-full p-1 shadow-lg",children:e.jsx(te,{className:"w-3 h-3 text-white fill-current"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-xl font-serif text-gray-900 truncate",children:m("personName")||"Nombre de la persona"}),e.jsxs("div",{className:"flex items-center text-gray-600 text-sm truncate",children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"truncate",children:m("personRole")||"Profesión"})]})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute -top-1 -left-1 w-6 h-6 text-emerald-800"}),e.jsxs("blockquote",{className:"text-gray-700 leading-relaxed pl-5 text-sm italic font-light",children:['"',m("description")||"Contenido de ejemplo",'"']})]})})]})]})}),e.jsx(I,{size:"lg",icon:C,variant:"primary",label:s?"Guardar Cambios":"Guardar Testimonio",className:"md:hidden",isLoading:x,disabled:!E||c,onClick:T(y)})]})]})};export{Se as default};
